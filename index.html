<!DOCTYPE html>
<html lang="bn" style="scroll-behavior: smooth;">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ইসলামিক নামের ভান্ডার — সুন্দর অর্থবহ মুসলিম নাম খুঁজুন</title>
  <meta name="description" content="ইসলামিক/মুসলিম ছেলে ও মেয়ের নামের সংগ্রহ। অর্থ, আরবি বানান, উচ্চারণ, উৎস, অনুযায়ী খুঁজুন ও পছন্দের তালিকা সংরক্ষণ করুন।"/>

  <link rel="preload" href="./HindSiliguri.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="./NotoNastaliqUrdu.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="./remixicon.woff2" as="font" type="font/woff2" crossorigin>
  <link href="./remixicon.css" rel="stylesheet">

<style>
/* Hind Siliguri fonts loaded locally */
@font-face {
  font-family: 'Hind Siliguri';
  src: url('./HindSiliguri.woff2') format('woff2');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

/* Noto Nastaliq Urdu font loaded locally */
@font-face {
  font-family: 'Noto Nastaliq Urdu';
  src: url('./NotoNastaliqUrdu.woff2') format('woff2');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

/* Brand color variables */
:root {
  --brand-50: #f3faf8;
  --brand-100: #d7f2ea;
  --brand-200: #b1e5d5;
  --brand-300: #82d6bd;
  --brand-400: #4ec5a5;
  --brand-500: #27b392;
  --brand-600: #1d9b83;
  --brand-700: #187e6b;
  --brand-800: #156257;
  --brand-900: #114f47;
  
  --aurora-50: #f7f8fc;
  --aurora-100: #e7ecfa;
  --aurora-200: #d1daf7;
  --aurora-300: #b0bff4;
  --aurora-400: #8aa2ef;
  --aurora-500: #6b86e7;
  --aurora-600: #576bd8;
  --aurora-700: #4a59bd;
  --aurora-800: #3e4a98;
  --aurora-900: #353f7a;
}

/* Custom utility classes */
.backdrop-blur-custom {
  backdrop-filter: saturate(160%) blur(10px);
  -webkit-backdrop-filter: saturate(160%) blur(10px);
}

.arabic {
  font-family: 'Noto Nastaliq Urdu', serif;
}

.modal-backdrop {
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
}

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideIn {
  from { transform: translateY(50px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.animate-shimmer {
  background: linear-gradient(90deg, rgba(0,0,0,0.06) 25%, rgba(0,0,0,0.12) 37%, rgba(0,0,0,0.06) 63%);
  background-size: 400% 100%;
  animation: shimmer 1.2s ease-in-out infinite;
}

.animate-fadeIn {
  animation: fadeIn 0.3s forwards;
}

.animate-slideIn {
  animation: slideIn 0.4s ease-out forwards;
}

.close-btn:hover {
  color: #4b5563 !important;
}

.chip:hover {
  transform: translateY(-2px) !important;
}

.chip.active {
  background-color: var(--brand-500) !important;
  color: white !important;
  border-color: var(--brand-600) !important;
}

/* Responsive styles */
@media (min-width: 768px) {
  .container-header {
    padding: 1.5rem 0 !important;
  }
  
  .main-title {
    font-size: 2.25rem !important;
    gap: 1rem !important;
  }
  
  .name-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  }
}

@media (min-width: 1024px) {
  .name-grid {
    grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  }
}
</style>
</head>
<body style="min-height: 100vh; font-family: 'Hind Siliguri', system-ui; background-color: #f8fafc; color: #111827; transition: all 0.3s;">

<div style="position: fixed; inset: 0; width: 100%; height: 100%; transition: all 0.3s; z-index: -10; background: linear-gradient(to top right, #d1daf7, #b1e5d5); opacity: 0.5;"> </div>
  <header class="container-header" style="display: flex; align-items: center; justify-content: space-between; padding: 1rem 1 1.5rem 1;">
    <div style="display: flex; align-items: center; gap: 1rem;">
      <h1 class="main-title" style="font-size: 2rem; font-weight: bold; display: flex; align-items: center; gap: 0.5rem; margin-left: 10px;">
        <i class="ri-book-2-line" style="color: var(--brand-600);"></i>
        <span>ইসলামিক নামের ভান্ডার</span>
      </h1>
  </header>

  <div style="margin-bottom: 2rem;">
    <div style="position: relative; margin-bottom: 1rem;">
      <input type="text" id="name-search" placeholder="নাম খুঁজুন..." style="width: 280px; height: 40px; padding-left: 60px; padding-right: 1px; padding-top: 1px; padding-bottom: 1px; border-radius: 18px; backdrop-filter: saturate(160%) blur(10px); -webkit-backdrop-filter: saturate(160%) blur(10px); background-color: rgba(255, 255, 255, 0.7); border: 1px solid rgba(17, 24, 39, 0.1); outline: none; transition: box-shadow 0.2s; color: #374151;" onfocus="this.style.boxShadow = '0 0 0 3px rgba(39, 179, 146, 0.5)'" onblur="this.style.boxShadow = 'none'">
      <i style="font-size: 1.5rem; position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: #9ca3af;" class="ri-search-line"></i>
    </div>

    <div style="display: flex; flex-wrap: wrap; align-items: center; gap: 1rem; justify-content: center;">
      <span style="font-size: 0.875rem; color: #4b5563;">নামের ধরণ:</span>
      <div style="display: flex; flex-wrap: wrap; gap: 0.75rem;">
        <div class="chip" data-filter="boy" style="display: flex; align-items: center; gap: 0.5rem; border-radius: 9999px; padding: 0.5rem 1rem; border: 1px solid rgba(17, 24, 39, 0.1); background-color: rgba(255, 255, 255, 0.7); cursor: pointer; user-select: none; transition: all 0.15s; transform: translateY(0);"><i class="ri-user-line"></i><span>ছেলে</span></div>
        <div class="chip" data-filter="girl" style="display: flex; align-items: center; gap: 0.5rem; border-radius: 9999px; padding: 0.5rem 1rem; border: 1px solid rgba(17, 24, 39, 0.1); background-color: rgba(255, 255, 255, 0.7); cursor: pointer; user-select: none; transition: all 0.15s; transform: translateY(0);"><i class="ri-women-line"></i><span>মেয়ে</span></div>
      </div>
    </div>
  </div>

  <div id="name-list" class="name-grid" style="display: grid; grid-template-columns: repeat(1, minmax(0, 1fr)); gap: 1.5rem;">
  </div>

  <div id="no-results" style="display: none; text-align: center; font-size: 1.25rem; color: #6b7280; padding: 4rem 0;">
    <i class="ri-error-warning-line" style="font-size: 3rem; margin-bottom: 1rem;"></i>
    <p>কোন নাম পাওয়া যায়নি।</p>
  </div>

  <div id="loading-spinner" style="display: none; text-align: center; padding: 4rem 0;">
    <div style="animation: spin 1s linear infinite; border-radius: 9999px; height: 4rem; width: 4rem; border-top: 2px solid var(--brand-500); border-bottom: 2px solid var(--brand-500); margin: 0 auto;"></div>
  </div>
</div>

<div id="modal" style="display: none; position: fixed; inset: 0; z-index: 100; overflow: auto; backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); background-color: rgba(0, 0, 0, 0.4); animation: fadeIn 0.3s forwards;">
  <div id="modal-content" style="position: relative; background-color: rgba(255, 255, 255, 0.85); margin: 10% auto; padding: 2rem; border-radius: 1.5rem; width: 90%; max-width: 600px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); animation: slideIn 0.4s ease-out forwards; border: 1px solid rgba(17, 24, 39, 0.1);">
    <span class="close-btn" style="position: absolute; top: 10px; right: 15px; font-size: 2rem; font-weight: bold; color: #9ca3af; cursor: pointer; transition: color 0.2s;">&times;</span>
    <div id="modal-body"></div>
  </div>
</div>

<script type="module">
  // Firebase configuration and initialization
  const firebaseConfig = {
    apiKey: "AIzaSyAC4h55aA0Zz--V5ejyndzR5WC_-9rAPio",
    authDomain: "subscribe-bot-6f9b2.firebaseapp.com",
    databaseURL: "https://subscribe-bot-6f9b2-default-rtdb.firebaseio.com",
    projectId: "subscribe-bot-6f9b2",
    storageBucket: "subscribe-bot-6f9b2.firebasestorage.app",
    messagingSenderId: "141787931031",
    appId: "1:141787931031:web:2108a3e930f5ce4fbc64d2",
    measurementId: "G-HSDKCJB14Y"
  };

  // Import Firebase functions from CDN
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getDatabase, ref, get, child, update, runTransaction as rtdbTransaction } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

  // Initialize Firebase
  let app, db;

  try {
    app = initializeApp(firebaseConfig);
    db = getDatabase(app);
  } catch (error) {
    console.error("Firebase initialization error:", error);
  }

  // DOM elements
  const nameListContainer = document.getElementById('name-list');
  const searchInput = document.getElementById('name-search');
  const filterChips = document.querySelectorAll('.chip[data-filter]');
  const noResultsMessage = document.getElementById('no-results');
  const loadingSpinner = document.getElementById('loading-spinner');

  // State
  let currentFilter = 'boy';
  let isLoading = false;

  // Constants for caching
  const CACHE_KEY_PREFIX = 'names_cache_';
  const CACHE_TIMESTAMP_KEY_PREFIX = 'names_cache_timestamp_';
  const CACHE_DURATION_MS = 30 * 24 * 60 * 60 * 1000; // 30 days in milliseconds

  // Function to render a single name card
  function renderNameCard(name) {
    return `
      <a href="details.html?nameKey=${name.nameKey}" data-name-key="${name.nameKey}" class="name-card-link" style="display: block; background-color: white; border-radius: 1.5rem; margin-left: 5px; margin-right: 5px; padding: 1.5rem; box-shadow: 0 10px 30px rgba(16, 24, 40, 0.08); transition: box-shadow 0.3s; cursor: pointer; text-decoration: none; color: inherit;" onmouseover="this.style.boxShadow='0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)'" onmouseout="this.style.boxShadow='0 10px 30px rgba(16, 24, 40, 0.08)'">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
          <h2 style="font-size: 1.5rem; font-weight: bold; color: var(--brand-700); margin: 0; line-height: 1.2;">
            ${name.name_bn}
          </h2>
        </div>
        <div style="margin-bottom: 1rem;">
          <p style="color: #4b5563; margin: 0 0 0.5rem 0;">
            <strong>অর্থ:</strong> ${name.meaning}
          </p>
          <p class="arabic" style="font-size: 1.5rem; margin: 0.5rem 0 0 0; color: #1f2937;">
            ${name.name_ar}
          </p>
        </div>
        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; font-size: 0.875rem;">
          <span style="display: flex; align-items: center; gap: 0.375rem; border-radius: 9999px; padding: 0.375rem 0.625rem; font-size: 0.75rem; font-weight: 600; line-height: 1; border: 1px dashed rgba(17, 24, 39, 0.1); background-color: rgba(17, 24, 39, 0.05);"><i class="${name.gender === 'boy' ? 'ri-user-line' : 'ri-women-line'}"></i> ${name.gender === 'boy' ? 'ছেলে' : 'মেয়ে'}</span>
          ${name.source ? `<span style="display: flex; align-items: center; gap: 0.375rem; border-radius: 9999px; padding: 0.375rem 0.625rem; font-size: 0.75rem; font-weight: 600; line-height: 1; border: 1px dashed rgba(17, 24, 39, 0.1); background-color: rgba(17, 24, 39, 0.05);"><i class="ri-book-3-line"></i> ${name.source}</span>` : ''}
          <span style="display: flex; align-items: center; gap: 0.375rem; border-radius: 9999px; padding: 0.375rem 0.625rem; font-size: 0.75rem; font-weight: 600; line-height: 1; border: 1px dashed rgba(17, 24, 39, 0.1); background-color: rgba(17, 24, 39, 0.05);"><i class="ri-fire-line"></i> ${name.clickCount || 0} clicks</span>
        </div>
      </a>
    `;
  }

  // New unified function to fetch data from cache or Firebase
  async function getNamesData(filter) {
    const cacheKey = CACHE_KEY_PREFIX + filter;
    const cacheTimestampKey = CACHE_TIMESTAMP_KEY_PREFIX + filter;
    const cachedData = localStorage.getItem(cacheKey);
    const cachedTimestamp = localStorage.getItem(cacheTimestampKey);

    if (cachedData && cachedTimestamp && (Date.now() - cachedTimestamp < CACHE_DURATION_MS)) {
        console.log("Using cached data for filter:", filter);
        return JSON.parse(cachedData);
    } else {
        console.log("Fetching new data from Firebase for filter:", filter);
        const namesRef = ref(db, `${filter}_names`);
        const popularityRef = ref(db, 'popularity/click');
        try {
            const [namesSnapshot, popularitySnapshot] = await Promise.all([
                get(namesRef),
                get(popularityRef)
            ]);

            const namesData = namesSnapshot.val() || {};
            const clickCounts = popularitySnapshot.val() || {};

            const namesArray = Object.keys(namesData).map(key => ({
                ...namesData[key],
                nameKey: key,
                gender: filter,
                clickCount: clickCounts[key] || 0
            }));

            // Save to cache
            localStorage.setItem(cacheKey, JSON.stringify(namesArray));
            localStorage.setItem(cacheTimestampKey, Date.now());

            return namesArray;

        } catch (error) {
            console.error("Error fetching names from Firebase:", error);
            return [];
        }
    }
  }

  // Function to render all names based on filter
  async function renderNames(filter) {
    if (isLoading) return;

    isLoading = true;
    loadingSpinner.style.display = 'block';
    nameListContainer.innerHTML = '';
    noResultsMessage.style.display = 'none';

    const namesArray = await getNamesData(filter);

    if (namesArray.length > 0) {
        // Sort alphabetically
        namesArray.sort((a, b) => a.name_en.localeCompare(b.name_en, 'en', { sensitivity: 'base' }));

        const nameCardsHTML = namesArray.map(renderNameCard).join('');
        nameListContainer.innerHTML = nameCardsHTML;
    } else {
        noResultsMessage.style.display = 'block';
    }

    isLoading = false;
    loadingSpinner.style.display = 'none';
  }

// Function to track a click on a name using Realtime Database transactions
async function trackClick(nameKey) {
    if (!db) {
        console.warn("Database not ready. Click not tracked.");
        return;
    }
    const clickRef = ref(db, `popularity/click/${nameKey}`);

    try {
      await rtdbTransaction(clickRef, (currentData) => {
        if (currentData) {
          return (currentData || 0) + 1;
        } else {
          return 1;
        }
      });
      console.log(`Click for ${nameKey} tracked successfully.`);
    } catch (e) {
        console.error("Error tracking click: ", e);
    }
}

// Event listeners for main filters
filterChips.forEach(chip => {
    chip.addEventListener('click', () => {
        document.querySelectorAll('.chip[data-filter]').forEach(c => c.classList.remove('active'));
        chip.classList.add('active');
        currentFilter = chip.dataset.filter;

        // Reset state for new filter
        searchInput.value = '';

        renderNames(currentFilter);
    });
});

// Event listener for search input
let searchTimeout = null;
searchInput.addEventListener('input', () => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(async () => {
        const searchTerm = searchInput.value.trim().toLowerCase();
        const namesArray = await getNamesData(currentFilter); // Get data from cache or Firebase

        if (searchTerm.length > 0) {
            const filteredNames = namesArray.filter(name => {
                return name.name_bn.toLowerCase().includes(searchTerm) || (name.meaning && name.meaning.toLowerCase().includes(searchTerm)) || (name.name_en && name.name_en.toLowerCase().includes(searchTerm));
            }).sort((a,b) => {
                if (b.clickCount !== a.clickCount) {
                    return b.clickCount - a.clickCount;
                }
                return a.name_en.localeCompare(b.name_en, 'en', { sensitivity: 'base' });
            });

            if (filteredNames.length > 0) {
                const nameCardsHTML = filteredNames.map(renderNameCard).join('');
                nameListContainer.innerHTML = nameCardsHTML;
                noResultsMessage.style.display = 'none';
            } else {
                nameListContainer.innerHTML = '';
                noResultsMessage.style.display = 'block';
            }
        } else {
            renderNames(currentFilter);
        }
    }, 300);
});

// Initial data fetch only for 'boy' filter
document.addEventListener('DOMContentLoaded', () => {
  const boyFilterChip = document.querySelector('.chip[data-filter="boy"]');
  if (boyFilterChip) {
      boyFilterChip.click();
  }
});
</script>
</body>
</html>